import batchspawner


spawner = batchspawner.SlurmSpawner()
spawner.exec_prefix = ''
spawner.batch_submit_cmd = 'sbatch'
spawner.job_name = '--job-name='  ## TODO: ?
spawner.batch_query_user_cmd = 'squeue --user='
spawner.batch_cancel_cmd = 'scancel '
spawner.req_nprocs = '1'  ## NODES_SERVER / SIMU
spawner.req_ntasks_per_node = '1'  ## PROC_PER_NODE
spawner.req_memory = '0'
spawner.req_runtime = '0:10:00'  # WALLTIME_SERVER / SIMU
spawner.req_output_log = 'melissa.%j.log'
spawner.req_error_log = 'melissa.%j.err'
spawner.req_options = '''date +\"%d/%m/%y %T\"
source @CMAKE_INSTALL_PREFIX@/bin/melissa_set_env.sh
# run Melissa
echo  \"### Launch Melissa\"
mkdir stats${job_id}.resu
cd stats${job_id}.resu
${SERVER_CMD}
wait %1
date +\"%d/%m/%y %T\"
cd ..
'''


## replacing spawner.batch_script
spawner.batch_script = '''#!/bin/bash
#SBATCH -N {nprocs}
#SBATCH --mem={memory}
#SBATCH --time={runtime}
#SBATCH --job-name=Melissa
#SBATCH -o melissa.%j.log
#SBATCH -e melissa.%j.err
{options}
'''
#SBATCH --ntasks-per-node={ntasks_per_node}  ## TODO: not implemented
#SBATCH -o {output_log}
#SBATCH -e {error_log}

spawner.simu_script = '''#!/bin/bash
#SBATCH -N {nnprocs}
#SBATCH --ntasks-per-node={ntasks_per_node}
#SBATCH --time={runtime}
#SBATCH -o simu.%j.log
#SBATCH -e simu.%j.err
'''
